// Copyright 2013-2022, University of Colorado Boulder

/**
 * Block shows R = ÏL/A formula with letters scaling
 * The layout is based off of the equals sign.
 *
 * @author Vasily Shakhov (Mlearner)
 * @author Anton Ulyanov (Mlearner)
 * @author John Blanco (PhET Interactive Simulations)
 * @author Michael Kauzmann (PhET Interactive Simulations)
 */

import Vector2 from '../../../../dot/js/Vector2.js';
import { Shape } from '../../../../kite/js/imports.js';
import platform from '../../../../phet-core/js/platform.js';
import StringUtils from '../../../../phetcommon/js/util/StringUtils.js';
import PhetFont from '../../../../scenery-phet/js/PhetFont.js';
import SceneryPhetStrings from '../../../../scenery-phet/js/SceneryPhetStrings.js';
import { Node, Path, Rectangle, Text } from '../../../../scenery/js/imports.js';
import resistanceInAWire from '../../resistanceInAWire.js';
import ResistanceInAWireStrings from '../../ResistanceInAWireStrings.js';
import ResistanceInAWireConstants from '../ResistanceInAWireConstants.js';
const areaSymbolString = ResistanceInAWireStrings.areaSymbol;
const lengthSymbolString = ResistanceInAWireStrings.lengthSymbol;
const resistanceSymbolString = ResistanceInAWireStrings.resistanceSymbol;
const symbolResistivityStringProperty = SceneryPhetStrings.symbol.resistivityStringProperty;
const equationResistanceEquationString = ResistanceInAWireStrings.a11y.equation.resistanceEquation;
const resistanceEquationDescriptionString = ResistanceInAWireStrings.a11y.equation.resistanceEquationDescription;
const rhoLAndAComparablePatternString = ResistanceInAWireStrings.a11y.equation.rhoLAndAComparablePattern;
const lAndAComparablePatternString = ResistanceInAWireStrings.a11y.equation.lAndAComparablePattern;
const noneComparablePatternString = ResistanceInAWireStrings.a11y.equation.noneComparablePattern;

// constants - rather than keep a reference to each letter node, a map from key to scale magnitude is used
// to track letter scales
const RESISTANCE_KEY = 'resistance';
const RESISTIVITY_KEY = 'resistivity';
const AREA_KEY = 'area';
const LENGTH_KEY = 'length';
class FormulaNode extends Node {
  /**
   * @param {ResistanceInAWireModel} model
   * @param {Tandem} tandem
   * @param {Object} [options]
   */
  constructor(model, tandem, options) {
    super({
      tandem: tandem,
      // pdom
      tagName: 'div',
      labelTagName: 'h3',
      labelContent: equationResistanceEquationString,
      descriptionContent: resistanceEquationDescriptionString
    });

    // equals sign, hard coded
    const equalsSignText = new Text('=', {
      // we never internationalize the '=' sign
      font: new PhetFont({
        family: ResistanceInAWireConstants.FONT_FAMILY,
        size: 90
      }),
      fill: ResistanceInAWireConstants.BLACK_COLOR,
      center: new Vector2(100, 0),
      tandem: tandem.createTandem('equalsSignText')
    });

    // maps identifier to scale magnitude
    this.a11yScaleMap = {};
    this.a11yScaleMap[RESISTANCE_KEY] = 0;
    this.a11yScaleMap[RESISTIVITY_KEY] = 0;
    this.a11yScaleMap[AREA_KEY] = 0;
    this.a11yScaleMap[LENGTH_KEY] = 0;

    // An array of attributes related to text
    const symbolTexts = [{
      label: resistanceSymbolString,
      center: new Vector2(equalsSignText.centerX - 100, 0),
      property: model.resistanceProperty,
      color: ResistanceInAWireConstants.RED_COLOR,
      cappedSize: true,
      // To make sure that the 'R' doesn't get too big, see https://github.com/phetsims/resistance-in-a-wire/issues/28
      tandem: tandem.createTandem('resistanceSymbolText'),
      scaleKey: RESISTANCE_KEY
    }, {
      label: symbolResistivityStringProperty,
      center: new Vector2(equalsSignText.centerX + 120, -90),
      property: model.resistivityProperty,
      color: ResistanceInAWireConstants.BLUE_COLOR,
      tandem: tandem.createTandem('resistivitySymbolText'),
      scaleKey: RESISTIVITY_KEY
    }, {
      label: lengthSymbolString,
      center: new Vector2(equalsSignText.centerX + 220, -90),
      property: model.lengthProperty,
      color: ResistanceInAWireConstants.BLUE_COLOR,
      tandem: tandem.createTandem('lengthSymbolText'),
      scaleKey: LENGTH_KEY
    }, {
      label: areaSymbolString,
      center: new Vector2(equalsSignText.centerX + 170, 90),
      property: model.areaProperty,
      color: ResistanceInAWireConstants.BLUE_COLOR,
      tandem: tandem.createTandem('areaSymbolText'),
      scaleKey: AREA_KEY
    }];

    // parent for all letters in the equation - given a 'p' tag for a11y because this node will hold the relative
    // size description, see getRelativeSizeDescription()
    const lettersNode = new Node({
      tagName: 'p'
    });

    // if we are on a safari platform render with canvas to prevent these issues, but only on safari because
    // canvas doesn't perform as well on other browsers
    // https://github.com/phetsims/resistance-in-a-wire/issues/108 and
    // https://github.com/phetsims/resistance-in-a-wire/issues/112
    if (platform.safari) {
      lettersNode.renderer = 'canvas';
    }

    // dynamically sized text
    symbolTexts.forEach(entry => {
      const text = new Text(entry.label, {
        font: new PhetFont({
          family: ResistanceInAWireConstants.FONT_FAMILY,
          size: 15
        }),
        fill: entry.color,
        center: entry.center,
        tandem: entry.tandem
      });

      // Add an invisible rectangle with bounds slightly larger than the text so that artifacts aren't left on the
      // screen, see https://github.com/phetsims/ohms-law/issues/26.
      // This also serves as the rectangle surrounding the 'R' that 'caps' the scaling when it gets too big.
      const antiArtifactRectangle = Rectangle.bounds(text.bounds.dilated(1), {
        fill: 'transparent'
      });
      const letterNode = new Node({
        children: [antiArtifactRectangle, text]
      });
      lettersNode.addChild(letterNode);

      // Set the scale based on the default value of the property; normalize the scale for all letters.
      const scale = 7 / entry.property.value; // empirically determined '7'

      // The size of the formula letter will scale with the value the letter represents. The accessible description for
      // the equation will also update. This does not need an unlink because it exists for the life of the sim.
      entry.property.link(value => {
        const scaleMagnitude = scale * value + 1;
        letterNode.setScaleMagnitude(scaleMagnitude);
        letterNode.center = entry.center;

        // for lookup when describing relative letter sizes
        this.a11yScaleMap[entry.scaleKey] = scaleMagnitude;
      });

      // linked lazily so that relative scales are defined
      entry.property.lazyLink(() => {
        lettersNode.setDescriptionContent(this.getRelativeSizeDescription());
      });
    });
    this.addChild(lettersNode);

    // Add the dividing line and equals sign after the letters so that they are on top when resistance is too large
    this.addChild(equalsSignText);

    // dividing line, hard coded
    this.addChild(new Path(Shape.lineSegment(150, 8, 400, 8), {
      stroke: 'black',
      lineWidth: 6,
      tandem: tandem.createTandem('dividingLine')
    }));
    this.mutate(options);

    // pdom - set the initial description
    lettersNode.setDescriptionContent(this.getRelativeSizeDescription());
  }

  /**
   * Get a description of the relative size of various letters. Size of each letter is described relative to
   * resistance R. When all or L and A letters are the same size, a simplified sentence is used to reduce verbosity,
   * so this function might return something like:
   *
   * "Size of letter R is comparable to the size of letter rho, letter L, and letter A" or
   * "Size of letter R is much larger than the size of letter rho, and slightly larger than letter L and letter A." or
   * "Size of letter R is much smaller than letter rho, comparable to letter L, and much much larger than letter A."
   *
   * @returns {string}
   * @private
   * @a11y
   */
  getRelativeSizeDescription() {
    const resistanceScale = this.a11yScaleMap[RESISTANCE_KEY];
    const resistivityScale = this.a11yScaleMap[RESISTIVITY_KEY];
    const areaScale = this.a11yScaleMap[AREA_KEY];
    const lengthScale = this.a11yScaleMap[LENGTH_KEY];
    const rToRho = resistanceScale / resistivityScale;
    const rToA = resistanceScale / areaScale;
    const rToL = resistanceScale / lengthScale;
    const lToA = lengthScale / areaScale;
    const lToRho = lengthScale / resistivityScale;
    const rToRhoDescription = getRelativeSizeDescription(rToRho);
    const roTLDescription = getRelativeSizeDescription(rToL);
    const rToADescription = getRelativeSizeDescription(rToA);
    let description;
    const comparableRange = ResistanceInAWireConstants.RELATIVE_SIZE_MAP.comparable.range;

    // even if right hand side variables are not comparable in size, if R is relatively larger or smaller than all
    // by the same amount, combine size description
    const relativeSizeKeys = Object.keys(ResistanceInAWireConstants.RELATIVE_SIZE_MAP);
    let allRelativeSizesSame = false;
    for (let i = 0; i < relativeSizeKeys.length; i++) {
      const key = relativeSizeKeys[i];
      const sizeRange = ResistanceInAWireConstants.RELATIVE_SIZE_MAP[key].range;
      const containsRToRho = sizeRange.contains(rToRho);
      const containsRToA = sizeRange.contains(rToA);
      const containsRToL = sizeRange.contains(rToL);
      if (containsRToRho && containsRToA && containsRToL) {
        allRelativeSizesSame = true;
        break;
      }
    }
    if (comparableRange.contains(lToA) && comparableRange.contains(lToRho) || allRelativeSizesSame) {
      // all right hand side letters are comparable in size
      description = StringUtils.fillIn(rhoLAndAComparablePatternString, {
        rToAll: rToRhoDescription // any size description will work
      });
    } else if (comparableRange.contains(lToA)) {
      // L and A are comparable, so they are the same size relative to R
      description = StringUtils.fillIn(lAndAComparablePatternString, {
        rToRho: rToRhoDescription,
        rToLAndA: roTLDescription // either length or area relative descriptions will work
      });
    } else {
      // all relative sizes could be unique
      description = StringUtils.fillIn(noneComparablePatternString, {
        rToRho: rToRhoDescription,
        rToL: roTLDescription,
        rToA: rToADescription
      });
    }
    return description;
  }
}
resistanceInAWire.register('FormulaNode', FormulaNode);

/**
 * Get a relative size description from a relative scale, used to describe letters relative to each other. Will return
 * something like
 *
 * "comparable to" or
 * "much much larger than"
 *
 * @param {number} relativeScale
 * @returns {string}
 */
const getRelativeSizeDescription = relativeScale => {
  // get described ranges of each relative scale
  const keys = Object.keys(ResistanceInAWireConstants.RELATIVE_SIZE_MAP);
  for (let i = 0; i < keys.length; i++) {
    const relativeEntry = ResistanceInAWireConstants.RELATIVE_SIZE_MAP[keys[i]];
    if (relativeEntry.range.contains(relativeScale)) {
      return relativeEntry.description;
    }
  }
  throw new Error(`no description found for relativeScale: ${relativeScale}`);
};
export default FormulaNode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJWZWN0b3IyIiwiU2hhcGUiLCJwbGF0Zm9ybSIsIlN0cmluZ1V0aWxzIiwiUGhldEZvbnQiLCJTY2VuZXJ5UGhldFN0cmluZ3MiLCJOb2RlIiwiUGF0aCIsIlJlY3RhbmdsZSIsIlRleHQiLCJyZXNpc3RhbmNlSW5BV2lyZSIsIlJlc2lzdGFuY2VJbkFXaXJlU3RyaW5ncyIsIlJlc2lzdGFuY2VJbkFXaXJlQ29uc3RhbnRzIiwiYXJlYVN5bWJvbFN0cmluZyIsImFyZWFTeW1ib2wiLCJsZW5ndGhTeW1ib2xTdHJpbmciLCJsZW5ndGhTeW1ib2wiLCJyZXNpc3RhbmNlU3ltYm9sU3RyaW5nIiwicmVzaXN0YW5jZVN5bWJvbCIsInN5bWJvbFJlc2lzdGl2aXR5U3RyaW5nUHJvcGVydHkiLCJzeW1ib2wiLCJyZXNpc3Rpdml0eVN0cmluZ1Byb3BlcnR5IiwiZXF1YXRpb25SZXNpc3RhbmNlRXF1YXRpb25TdHJpbmciLCJhMTF5IiwiZXF1YXRpb24iLCJyZXNpc3RhbmNlRXF1YXRpb24iLCJyZXNpc3RhbmNlRXF1YXRpb25EZXNjcmlwdGlvblN0cmluZyIsInJlc2lzdGFuY2VFcXVhdGlvbkRlc2NyaXB0aW9uIiwicmhvTEFuZEFDb21wYXJhYmxlUGF0dGVyblN0cmluZyIsInJob0xBbmRBQ29tcGFyYWJsZVBhdHRlcm4iLCJsQW5kQUNvbXBhcmFibGVQYXR0ZXJuU3RyaW5nIiwibEFuZEFDb21wYXJhYmxlUGF0dGVybiIsIm5vbmVDb21wYXJhYmxlUGF0dGVyblN0cmluZyIsIm5vbmVDb21wYXJhYmxlUGF0dGVybiIsIlJFU0lTVEFOQ0VfS0VZIiwiUkVTSVNUSVZJVFlfS0VZIiwiQVJFQV9LRVkiLCJMRU5HVEhfS0VZIiwiRm9ybXVsYU5vZGUiLCJjb25zdHJ1Y3RvciIsIm1vZGVsIiwidGFuZGVtIiwib3B0aW9ucyIsInRhZ05hbWUiLCJsYWJlbFRhZ05hbWUiLCJsYWJlbENvbnRlbnQiLCJkZXNjcmlwdGlvbkNvbnRlbnQiLCJlcXVhbHNTaWduVGV4dCIsImZvbnQiLCJmYW1pbHkiLCJGT05UX0ZBTUlMWSIsInNpemUiLCJmaWxsIiwiQkxBQ0tfQ09MT1IiLCJjZW50ZXIiLCJjcmVhdGVUYW5kZW0iLCJhMTF5U2NhbGVNYXAiLCJzeW1ib2xUZXh0cyIsImxhYmVsIiwiY2VudGVyWCIsInByb3BlcnR5IiwicmVzaXN0YW5jZVByb3BlcnR5IiwiY29sb3IiLCJSRURfQ09MT1IiLCJjYXBwZWRTaXplIiwic2NhbGVLZXkiLCJyZXNpc3Rpdml0eVByb3BlcnR5IiwiQkxVRV9DT0xPUiIsImxlbmd0aFByb3BlcnR5IiwiYXJlYVByb3BlcnR5IiwibGV0dGVyc05vZGUiLCJzYWZhcmkiLCJyZW5kZXJlciIsImZvckVhY2giLCJlbnRyeSIsInRleHQiLCJhbnRpQXJ0aWZhY3RSZWN0YW5nbGUiLCJib3VuZHMiLCJkaWxhdGVkIiwibGV0dGVyTm9kZSIsImNoaWxkcmVuIiwiYWRkQ2hpbGQiLCJzY2FsZSIsInZhbHVlIiwibGluayIsInNjYWxlTWFnbml0dWRlIiwic2V0U2NhbGVNYWduaXR1ZGUiLCJsYXp5TGluayIsInNldERlc2NyaXB0aW9uQ29udGVudCIsImdldFJlbGF0aXZlU2l6ZURlc2NyaXB0aW9uIiwibGluZVNlZ21lbnQiLCJzdHJva2UiLCJsaW5lV2lkdGgiLCJtdXRhdGUiLCJyZXNpc3RhbmNlU2NhbGUiLCJyZXNpc3Rpdml0eVNjYWxlIiwiYXJlYVNjYWxlIiwibGVuZ3RoU2NhbGUiLCJyVG9SaG8iLCJyVG9BIiwiclRvTCIsImxUb0EiLCJsVG9SaG8iLCJyVG9SaG9EZXNjcmlwdGlvbiIsInJvVExEZXNjcmlwdGlvbiIsInJUb0FEZXNjcmlwdGlvbiIsImRlc2NyaXB0aW9uIiwiY29tcGFyYWJsZVJhbmdlIiwiUkVMQVRJVkVfU0laRV9NQVAiLCJjb21wYXJhYmxlIiwicmFuZ2UiLCJyZWxhdGl2ZVNpemVLZXlzIiwiT2JqZWN0Iiwia2V5cyIsImFsbFJlbGF0aXZlU2l6ZXNTYW1lIiwiaSIsImxlbmd0aCIsImtleSIsInNpemVSYW5nZSIsImNvbnRhaW5zUlRvUmhvIiwiY29udGFpbnMiLCJjb250YWluc1JUb0EiLCJjb250YWluc1JUb0wiLCJmaWxsSW4iLCJyVG9BbGwiLCJyVG9MQW5kQSIsInJlZ2lzdGVyIiwicmVsYXRpdmVTY2FsZSIsInJlbGF0aXZlRW50cnkiLCJFcnJvciJdLCJzb3VyY2VzIjpbIkZvcm11bGFOb2RlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDEzLTIwMjIsIFVuaXZlcnNpdHkgb2YgQ29sb3JhZG8gQm91bGRlclxyXG5cclxuLyoqXHJcbiAqIEJsb2NrIHNob3dzIFIgPSDPgUwvQSBmb3JtdWxhIHdpdGggbGV0dGVycyBzY2FsaW5nXHJcbiAqIFRoZSBsYXlvdXQgaXMgYmFzZWQgb2ZmIG9mIHRoZSBlcXVhbHMgc2lnbi5cclxuICpcclxuICogQGF1dGhvciBWYXNpbHkgU2hha2hvdiAoTWxlYXJuZXIpXHJcbiAqIEBhdXRob3IgQW50b24gVWx5YW5vdiAoTWxlYXJuZXIpXHJcbiAqIEBhdXRob3IgSm9obiBCbGFuY28gKFBoRVQgSW50ZXJhY3RpdmUgU2ltdWxhdGlvbnMpXHJcbiAqIEBhdXRob3IgTWljaGFlbCBLYXV6bWFubiAoUGhFVCBJbnRlcmFjdGl2ZSBTaW11bGF0aW9ucylcclxuICovXHJcblxyXG5pbXBvcnQgVmVjdG9yMiBmcm9tICcuLi8uLi8uLi8uLi9kb3QvanMvVmVjdG9yMi5qcyc7XHJcbmltcG9ydCB7IFNoYXBlIH0gZnJvbSAnLi4vLi4vLi4vLi4va2l0ZS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IHBsYXRmb3JtIGZyb20gJy4uLy4uLy4uLy4uL3BoZXQtY29yZS9qcy9wbGF0Zm9ybS5qcyc7XHJcbmltcG9ydCBTdHJpbmdVdGlscyBmcm9tICcuLi8uLi8uLi8uLi9waGV0Y29tbW9uL2pzL3V0aWwvU3RyaW5nVXRpbHMuanMnO1xyXG5pbXBvcnQgUGhldEZvbnQgZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS1waGV0L2pzL1BoZXRGb250LmpzJztcclxuaW1wb3J0IFNjZW5lcnlQaGV0U3RyaW5ncyBmcm9tICcuLi8uLi8uLi8uLi9zY2VuZXJ5LXBoZXQvanMvU2NlbmVyeVBoZXRTdHJpbmdzLmpzJztcclxuaW1wb3J0IHsgTm9kZSwgUGF0aCwgUmVjdGFuZ2xlLCBUZXh0IH0gZnJvbSAnLi4vLi4vLi4vLi4vc2NlbmVyeS9qcy9pbXBvcnRzLmpzJztcclxuaW1wb3J0IHJlc2lzdGFuY2VJbkFXaXJlIGZyb20gJy4uLy4uL3Jlc2lzdGFuY2VJbkFXaXJlLmpzJztcclxuaW1wb3J0IFJlc2lzdGFuY2VJbkFXaXJlU3RyaW5ncyBmcm9tICcuLi8uLi9SZXNpc3RhbmNlSW5BV2lyZVN0cmluZ3MuanMnO1xyXG5pbXBvcnQgUmVzaXN0YW5jZUluQVdpcmVDb25zdGFudHMgZnJvbSAnLi4vUmVzaXN0YW5jZUluQVdpcmVDb25zdGFudHMuanMnO1xyXG5cclxuY29uc3QgYXJlYVN5bWJvbFN0cmluZyA9IFJlc2lzdGFuY2VJbkFXaXJlU3RyaW5ncy5hcmVhU3ltYm9sO1xyXG5jb25zdCBsZW5ndGhTeW1ib2xTdHJpbmcgPSBSZXNpc3RhbmNlSW5BV2lyZVN0cmluZ3MubGVuZ3RoU3ltYm9sO1xyXG5jb25zdCByZXNpc3RhbmNlU3ltYm9sU3RyaW5nID0gUmVzaXN0YW5jZUluQVdpcmVTdHJpbmdzLnJlc2lzdGFuY2VTeW1ib2w7XHJcbmNvbnN0IHN5bWJvbFJlc2lzdGl2aXR5U3RyaW5nUHJvcGVydHkgPSBTY2VuZXJ5UGhldFN0cmluZ3Muc3ltYm9sLnJlc2lzdGl2aXR5U3RyaW5nUHJvcGVydHk7XHJcbmNvbnN0IGVxdWF0aW9uUmVzaXN0YW5jZUVxdWF0aW9uU3RyaW5nID0gUmVzaXN0YW5jZUluQVdpcmVTdHJpbmdzLmExMXkuZXF1YXRpb24ucmVzaXN0YW5jZUVxdWF0aW9uO1xyXG5jb25zdCByZXNpc3RhbmNlRXF1YXRpb25EZXNjcmlwdGlvblN0cmluZyA9IFJlc2lzdGFuY2VJbkFXaXJlU3RyaW5ncy5hMTF5LmVxdWF0aW9uLnJlc2lzdGFuY2VFcXVhdGlvbkRlc2NyaXB0aW9uO1xyXG5jb25zdCByaG9MQW5kQUNvbXBhcmFibGVQYXR0ZXJuU3RyaW5nID0gUmVzaXN0YW5jZUluQVdpcmVTdHJpbmdzLmExMXkuZXF1YXRpb24ucmhvTEFuZEFDb21wYXJhYmxlUGF0dGVybjtcclxuY29uc3QgbEFuZEFDb21wYXJhYmxlUGF0dGVyblN0cmluZyA9IFJlc2lzdGFuY2VJbkFXaXJlU3RyaW5ncy5hMTF5LmVxdWF0aW9uLmxBbmRBQ29tcGFyYWJsZVBhdHRlcm47XHJcbmNvbnN0IG5vbmVDb21wYXJhYmxlUGF0dGVyblN0cmluZyA9IFJlc2lzdGFuY2VJbkFXaXJlU3RyaW5ncy5hMTF5LmVxdWF0aW9uLm5vbmVDb21wYXJhYmxlUGF0dGVybjtcclxuXHJcbi8vIGNvbnN0YW50cyAtIHJhdGhlciB0aGFuIGtlZXAgYSByZWZlcmVuY2UgdG8gZWFjaCBsZXR0ZXIgbm9kZSwgYSBtYXAgZnJvbSBrZXkgdG8gc2NhbGUgbWFnbml0dWRlIGlzIHVzZWRcclxuLy8gdG8gdHJhY2sgbGV0dGVyIHNjYWxlc1xyXG5jb25zdCBSRVNJU1RBTkNFX0tFWSA9ICdyZXNpc3RhbmNlJztcclxuY29uc3QgUkVTSVNUSVZJVFlfS0VZID0gJ3Jlc2lzdGl2aXR5JztcclxuY29uc3QgQVJFQV9LRVkgPSAnYXJlYSc7XHJcbmNvbnN0IExFTkdUSF9LRVkgPSAnbGVuZ3RoJztcclxuXHJcbmNsYXNzIEZvcm11bGFOb2RlIGV4dGVuZHMgTm9kZSB7XHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtSZXNpc3RhbmNlSW5BV2lyZU1vZGVsfSBtb2RlbFxyXG4gICAqIEBwYXJhbSB7VGFuZGVtfSB0YW5kZW1cclxuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoIG1vZGVsLCB0YW5kZW0sIG9wdGlvbnMgKSB7XHJcblxyXG4gICAgc3VwZXIoIHtcclxuICAgICAgdGFuZGVtOiB0YW5kZW0sXHJcblxyXG4gICAgICAvLyBwZG9tXHJcbiAgICAgIHRhZ05hbWU6ICdkaXYnLFxyXG4gICAgICBsYWJlbFRhZ05hbWU6ICdoMycsXHJcbiAgICAgIGxhYmVsQ29udGVudDogZXF1YXRpb25SZXNpc3RhbmNlRXF1YXRpb25TdHJpbmcsXHJcbiAgICAgIGRlc2NyaXB0aW9uQ29udGVudDogcmVzaXN0YW5jZUVxdWF0aW9uRGVzY3JpcHRpb25TdHJpbmdcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBlcXVhbHMgc2lnbiwgaGFyZCBjb2RlZFxyXG4gICAgY29uc3QgZXF1YWxzU2lnblRleHQgPSBuZXcgVGV4dCggJz0nLCB7IC8vIHdlIG5ldmVyIGludGVybmF0aW9uYWxpemUgdGhlICc9JyBzaWduXHJcbiAgICAgIGZvbnQ6IG5ldyBQaGV0Rm9udCggeyBmYW1pbHk6IFJlc2lzdGFuY2VJbkFXaXJlQ29uc3RhbnRzLkZPTlRfRkFNSUxZLCBzaXplOiA5MCB9ICksXHJcbiAgICAgIGZpbGw6IFJlc2lzdGFuY2VJbkFXaXJlQ29uc3RhbnRzLkJMQUNLX0NPTE9SLFxyXG4gICAgICBjZW50ZXI6IG5ldyBWZWN0b3IyKCAxMDAsIDAgKSxcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnZXF1YWxzU2lnblRleHQnIClcclxuICAgIH0gKTtcclxuXHJcbiAgICAvLyBtYXBzIGlkZW50aWZpZXIgdG8gc2NhbGUgbWFnbml0dWRlXHJcbiAgICB0aGlzLmExMXlTY2FsZU1hcCA9IHt9O1xyXG4gICAgdGhpcy5hMTF5U2NhbGVNYXBbIFJFU0lTVEFOQ0VfS0VZIF0gPSAwO1xyXG4gICAgdGhpcy5hMTF5U2NhbGVNYXBbIFJFU0lTVElWSVRZX0tFWSBdID0gMDtcclxuICAgIHRoaXMuYTExeVNjYWxlTWFwWyBBUkVBX0tFWSBdID0gMDtcclxuICAgIHRoaXMuYTExeVNjYWxlTWFwWyBMRU5HVEhfS0VZIF0gPSAwO1xyXG5cclxuICAgIC8vIEFuIGFycmF5IG9mIGF0dHJpYnV0ZXMgcmVsYXRlZCB0byB0ZXh0XHJcbiAgICBjb25zdCBzeW1ib2xUZXh0cyA9IFsge1xyXG4gICAgICBsYWJlbDogcmVzaXN0YW5jZVN5bWJvbFN0cmluZyxcclxuICAgICAgY2VudGVyOiBuZXcgVmVjdG9yMiggZXF1YWxzU2lnblRleHQuY2VudGVyWCAtIDEwMCwgMCApLFxyXG4gICAgICBwcm9wZXJ0eTogbW9kZWwucmVzaXN0YW5jZVByb3BlcnR5LFxyXG4gICAgICBjb2xvcjogUmVzaXN0YW5jZUluQVdpcmVDb25zdGFudHMuUkVEX0NPTE9SLFxyXG4gICAgICBjYXBwZWRTaXplOiB0cnVlLCAvLyBUbyBtYWtlIHN1cmUgdGhhdCB0aGUgJ1InIGRvZXNuJ3QgZ2V0IHRvbyBiaWcsIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvcmVzaXN0YW5jZS1pbi1hLXdpcmUvaXNzdWVzLzI4XHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Jlc2lzdGFuY2VTeW1ib2xUZXh0JyApLFxyXG4gICAgICBzY2FsZUtleTogUkVTSVNUQU5DRV9LRVlcclxuICAgIH0sIHtcclxuICAgICAgbGFiZWw6IHN5bWJvbFJlc2lzdGl2aXR5U3RyaW5nUHJvcGVydHksXHJcbiAgICAgIGNlbnRlcjogbmV3IFZlY3RvcjIoIGVxdWFsc1NpZ25UZXh0LmNlbnRlclggKyAxMjAsIC05MCApLFxyXG4gICAgICBwcm9wZXJ0eTogbW9kZWwucmVzaXN0aXZpdHlQcm9wZXJ0eSxcclxuICAgICAgY29sb3I6IFJlc2lzdGFuY2VJbkFXaXJlQ29uc3RhbnRzLkJMVUVfQ09MT1IsXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ3Jlc2lzdGl2aXR5U3ltYm9sVGV4dCcgKSxcclxuICAgICAgc2NhbGVLZXk6IFJFU0lTVElWSVRZX0tFWVxyXG4gICAgfSwge1xyXG4gICAgICBsYWJlbDogbGVuZ3RoU3ltYm9sU3RyaW5nLFxyXG4gICAgICBjZW50ZXI6IG5ldyBWZWN0b3IyKCBlcXVhbHNTaWduVGV4dC5jZW50ZXJYICsgMjIwLCAtOTAgKSxcclxuICAgICAgcHJvcGVydHk6IG1vZGVsLmxlbmd0aFByb3BlcnR5LFxyXG4gICAgICBjb2xvcjogUmVzaXN0YW5jZUluQVdpcmVDb25zdGFudHMuQkxVRV9DT0xPUixcclxuICAgICAgdGFuZGVtOiB0YW5kZW0uY3JlYXRlVGFuZGVtKCAnbGVuZ3RoU3ltYm9sVGV4dCcgKSxcclxuICAgICAgc2NhbGVLZXk6IExFTkdUSF9LRVlcclxuICAgIH0sIHtcclxuICAgICAgbGFiZWw6IGFyZWFTeW1ib2xTdHJpbmcsXHJcbiAgICAgIGNlbnRlcjogbmV3IFZlY3RvcjIoIGVxdWFsc1NpZ25UZXh0LmNlbnRlclggKyAxNzAsIDkwICksXHJcbiAgICAgIHByb3BlcnR5OiBtb2RlbC5hcmVhUHJvcGVydHksXHJcbiAgICAgIGNvbG9yOiBSZXNpc3RhbmNlSW5BV2lyZUNvbnN0YW50cy5CTFVFX0NPTE9SLFxyXG4gICAgICB0YW5kZW06IHRhbmRlbS5jcmVhdGVUYW5kZW0oICdhcmVhU3ltYm9sVGV4dCcgKSxcclxuICAgICAgc2NhbGVLZXk6IEFSRUFfS0VZXHJcbiAgICB9IF07XHJcblxyXG4gICAgLy8gcGFyZW50IGZvciBhbGwgbGV0dGVycyBpbiB0aGUgZXF1YXRpb24gLSBnaXZlbiBhICdwJyB0YWcgZm9yIGExMXkgYmVjYXVzZSB0aGlzIG5vZGUgd2lsbCBob2xkIHRoZSByZWxhdGl2ZVxyXG4gICAgLy8gc2l6ZSBkZXNjcmlwdGlvbiwgc2VlIGdldFJlbGF0aXZlU2l6ZURlc2NyaXB0aW9uKClcclxuICAgIGNvbnN0IGxldHRlcnNOb2RlID0gbmV3IE5vZGUoIHsgdGFnTmFtZTogJ3AnIH0gKTtcclxuXHJcbiAgICAvLyBpZiB3ZSBhcmUgb24gYSBzYWZhcmkgcGxhdGZvcm0gcmVuZGVyIHdpdGggY2FudmFzIHRvIHByZXZlbnQgdGhlc2UgaXNzdWVzLCBidXQgb25seSBvbiBzYWZhcmkgYmVjYXVzZVxyXG4gICAgLy8gY2FudmFzIGRvZXNuJ3QgcGVyZm9ybSBhcyB3ZWxsIG9uIG90aGVyIGJyb3dzZXJzXHJcbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvcmVzaXN0YW5jZS1pbi1hLXdpcmUvaXNzdWVzLzEwOCBhbmRcclxuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9waGV0c2ltcy9yZXNpc3RhbmNlLWluLWEtd2lyZS9pc3N1ZXMvMTEyXHJcbiAgICBpZiAoIHBsYXRmb3JtLnNhZmFyaSApIHsgbGV0dGVyc05vZGUucmVuZGVyZXIgPSAnY2FudmFzJzsgfVxyXG5cclxuICAgIC8vIGR5bmFtaWNhbGx5IHNpemVkIHRleHRcclxuICAgIHN5bWJvbFRleHRzLmZvckVhY2goIGVudHJ5ID0+IHtcclxuXHJcbiAgICAgIGNvbnN0IHRleHQgPSBuZXcgVGV4dCggZW50cnkubGFiZWwsIHtcclxuICAgICAgICBmb250OiBuZXcgUGhldEZvbnQoIHsgZmFtaWx5OiBSZXNpc3RhbmNlSW5BV2lyZUNvbnN0YW50cy5GT05UX0ZBTUlMWSwgc2l6ZTogMTUgfSApLFxyXG4gICAgICAgIGZpbGw6IGVudHJ5LmNvbG9yLFxyXG4gICAgICAgIGNlbnRlcjogZW50cnkuY2VudGVyLFxyXG4gICAgICAgIHRhbmRlbTogZW50cnkudGFuZGVtXHJcbiAgICAgIH0gKTtcclxuXHJcbiAgICAgIC8vIEFkZCBhbiBpbnZpc2libGUgcmVjdGFuZ2xlIHdpdGggYm91bmRzIHNsaWdodGx5IGxhcmdlciB0aGFuIHRoZSB0ZXh0IHNvIHRoYXQgYXJ0aWZhY3RzIGFyZW4ndCBsZWZ0IG9uIHRoZVxyXG4gICAgICAvLyBzY3JlZW4sIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcGhldHNpbXMvb2htcy1sYXcvaXNzdWVzLzI2LlxyXG4gICAgICAvLyBUaGlzIGFsc28gc2VydmVzIGFzIHRoZSByZWN0YW5nbGUgc3Vycm91bmRpbmcgdGhlICdSJyB0aGF0ICdjYXBzJyB0aGUgc2NhbGluZyB3aGVuIGl0IGdldHMgdG9vIGJpZy5cclxuICAgICAgY29uc3QgYW50aUFydGlmYWN0UmVjdGFuZ2xlID0gUmVjdGFuZ2xlLmJvdW5kcyggdGV4dC5ib3VuZHMuZGlsYXRlZCggMSApLCB7IGZpbGw6ICd0cmFuc3BhcmVudCcgfSApO1xyXG5cclxuICAgICAgY29uc3QgbGV0dGVyTm9kZSA9IG5ldyBOb2RlKCB7IGNoaWxkcmVuOiBbIGFudGlBcnRpZmFjdFJlY3RhbmdsZSwgdGV4dCBdIH0gKTtcclxuICAgICAgbGV0dGVyc05vZGUuYWRkQ2hpbGQoIGxldHRlck5vZGUgKTtcclxuXHJcbiAgICAgIC8vIFNldCB0aGUgc2NhbGUgYmFzZWQgb24gdGhlIGRlZmF1bHQgdmFsdWUgb2YgdGhlIHByb3BlcnR5OyBub3JtYWxpemUgdGhlIHNjYWxlIGZvciBhbGwgbGV0dGVycy5cclxuICAgICAgY29uc3Qgc2NhbGUgPSA3IC8gZW50cnkucHJvcGVydHkudmFsdWU7IC8vIGVtcGlyaWNhbGx5IGRldGVybWluZWQgJzcnXHJcblxyXG4gICAgICAvLyBUaGUgc2l6ZSBvZiB0aGUgZm9ybXVsYSBsZXR0ZXIgd2lsbCBzY2FsZSB3aXRoIHRoZSB2YWx1ZSB0aGUgbGV0dGVyIHJlcHJlc2VudHMuIFRoZSBhY2Nlc3NpYmxlIGRlc2NyaXB0aW9uIGZvclxyXG4gICAgICAvLyB0aGUgZXF1YXRpb24gd2lsbCBhbHNvIHVwZGF0ZS4gVGhpcyBkb2VzIG5vdCBuZWVkIGFuIHVubGluayBiZWNhdXNlIGl0IGV4aXN0cyBmb3IgdGhlIGxpZmUgb2YgdGhlIHNpbS5cclxuICAgICAgZW50cnkucHJvcGVydHkubGluayggdmFsdWUgPT4ge1xyXG4gICAgICAgIGNvbnN0IHNjYWxlTWFnbml0dWRlID0gc2NhbGUgKiB2YWx1ZSArIDE7XHJcbiAgICAgICAgbGV0dGVyTm9kZS5zZXRTY2FsZU1hZ25pdHVkZSggc2NhbGVNYWduaXR1ZGUgKTtcclxuICAgICAgICBsZXR0ZXJOb2RlLmNlbnRlciA9IGVudHJ5LmNlbnRlcjtcclxuXHJcbiAgICAgICAgLy8gZm9yIGxvb2t1cCB3aGVuIGRlc2NyaWJpbmcgcmVsYXRpdmUgbGV0dGVyIHNpemVzXHJcbiAgICAgICAgdGhpcy5hMTF5U2NhbGVNYXBbIGVudHJ5LnNjYWxlS2V5IF0gPSBzY2FsZU1hZ25pdHVkZTtcclxuICAgICAgfSApO1xyXG5cclxuICAgICAgLy8gbGlua2VkIGxhemlseSBzbyB0aGF0IHJlbGF0aXZlIHNjYWxlcyBhcmUgZGVmaW5lZFxyXG4gICAgICBlbnRyeS5wcm9wZXJ0eS5sYXp5TGluayggKCkgPT4ge1xyXG4gICAgICAgIGxldHRlcnNOb2RlLnNldERlc2NyaXB0aW9uQ29udGVudCggdGhpcy5nZXRSZWxhdGl2ZVNpemVEZXNjcmlwdGlvbigpICk7XHJcbiAgICAgIH0gKTtcclxuICAgIH0gKTtcclxuXHJcbiAgICB0aGlzLmFkZENoaWxkKCBsZXR0ZXJzTm9kZSApO1xyXG5cclxuICAgIC8vIEFkZCB0aGUgZGl2aWRpbmcgbGluZSBhbmQgZXF1YWxzIHNpZ24gYWZ0ZXIgdGhlIGxldHRlcnMgc28gdGhhdCB0aGV5IGFyZSBvbiB0b3Agd2hlbiByZXNpc3RhbmNlIGlzIHRvbyBsYXJnZVxyXG4gICAgdGhpcy5hZGRDaGlsZCggZXF1YWxzU2lnblRleHQgKTtcclxuXHJcbiAgICAvLyBkaXZpZGluZyBsaW5lLCBoYXJkIGNvZGVkXHJcbiAgICB0aGlzLmFkZENoaWxkKCBuZXcgUGF0aCggU2hhcGUubGluZVNlZ21lbnQoIDE1MCwgOCwgNDAwLCA4ICksIHtcclxuICAgICAgc3Ryb2tlOiAnYmxhY2snLFxyXG4gICAgICBsaW5lV2lkdGg6IDYsXHJcbiAgICAgIHRhbmRlbTogdGFuZGVtLmNyZWF0ZVRhbmRlbSggJ2RpdmlkaW5nTGluZScgKVxyXG4gICAgfSApICk7XHJcblxyXG4gICAgdGhpcy5tdXRhdGUoIG9wdGlvbnMgKTtcclxuXHJcbiAgICAvLyBwZG9tIC0gc2V0IHRoZSBpbml0aWFsIGRlc2NyaXB0aW9uXHJcbiAgICBsZXR0ZXJzTm9kZS5zZXREZXNjcmlwdGlvbkNvbnRlbnQoIHRoaXMuZ2V0UmVsYXRpdmVTaXplRGVzY3JpcHRpb24oKSApO1xyXG4gIH1cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBhIGRlc2NyaXB0aW9uIG9mIHRoZSByZWxhdGl2ZSBzaXplIG9mIHZhcmlvdXMgbGV0dGVycy4gU2l6ZSBvZiBlYWNoIGxldHRlciBpcyBkZXNjcmliZWQgcmVsYXRpdmUgdG9cclxuICAgKiByZXNpc3RhbmNlIFIuIFdoZW4gYWxsIG9yIEwgYW5kIEEgbGV0dGVycyBhcmUgdGhlIHNhbWUgc2l6ZSwgYSBzaW1wbGlmaWVkIHNlbnRlbmNlIGlzIHVzZWQgdG8gcmVkdWNlIHZlcmJvc2l0eSxcclxuICAgKiBzbyB0aGlzIGZ1bmN0aW9uIG1pZ2h0IHJldHVybiBzb21ldGhpbmcgbGlrZTpcclxuICAgKlxyXG4gICAqIFwiU2l6ZSBvZiBsZXR0ZXIgUiBpcyBjb21wYXJhYmxlIHRvIHRoZSBzaXplIG9mIGxldHRlciByaG8sIGxldHRlciBMLCBhbmQgbGV0dGVyIEFcIiBvclxyXG4gICAqIFwiU2l6ZSBvZiBsZXR0ZXIgUiBpcyBtdWNoIGxhcmdlciB0aGFuIHRoZSBzaXplIG9mIGxldHRlciByaG8sIGFuZCBzbGlnaHRseSBsYXJnZXIgdGhhbiBsZXR0ZXIgTCBhbmQgbGV0dGVyIEEuXCIgb3JcclxuICAgKiBcIlNpemUgb2YgbGV0dGVyIFIgaXMgbXVjaCBzbWFsbGVyIHRoYW4gbGV0dGVyIHJobywgY29tcGFyYWJsZSB0byBsZXR0ZXIgTCwgYW5kIG11Y2ggbXVjaCBsYXJnZXIgdGhhbiBsZXR0ZXIgQS5cIlxyXG4gICAqXHJcbiAgICogQHJldHVybnMge3N0cmluZ31cclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqIEBhMTF5XHJcbiAgICovXHJcbiAgZ2V0UmVsYXRpdmVTaXplRGVzY3JpcHRpb24oKSB7XHJcbiAgICBjb25zdCByZXNpc3RhbmNlU2NhbGUgPSB0aGlzLmExMXlTY2FsZU1hcFsgUkVTSVNUQU5DRV9LRVkgXTtcclxuICAgIGNvbnN0IHJlc2lzdGl2aXR5U2NhbGUgPSB0aGlzLmExMXlTY2FsZU1hcFsgUkVTSVNUSVZJVFlfS0VZIF07XHJcbiAgICBjb25zdCBhcmVhU2NhbGUgPSB0aGlzLmExMXlTY2FsZU1hcFsgQVJFQV9LRVkgXTtcclxuICAgIGNvbnN0IGxlbmd0aFNjYWxlID0gdGhpcy5hMTF5U2NhbGVNYXBbIExFTkdUSF9LRVkgXTtcclxuXHJcbiAgICBjb25zdCByVG9SaG8gPSByZXNpc3RhbmNlU2NhbGUgLyByZXNpc3Rpdml0eVNjYWxlO1xyXG4gICAgY29uc3QgclRvQSA9IHJlc2lzdGFuY2VTY2FsZSAvIGFyZWFTY2FsZTtcclxuICAgIGNvbnN0IHJUb0wgPSByZXNpc3RhbmNlU2NhbGUgLyBsZW5ndGhTY2FsZTtcclxuICAgIGNvbnN0IGxUb0EgPSBsZW5ndGhTY2FsZSAvIGFyZWFTY2FsZTtcclxuICAgIGNvbnN0IGxUb1JobyA9IGxlbmd0aFNjYWxlIC8gcmVzaXN0aXZpdHlTY2FsZTtcclxuXHJcbiAgICBjb25zdCByVG9SaG9EZXNjcmlwdGlvbiA9IGdldFJlbGF0aXZlU2l6ZURlc2NyaXB0aW9uKCByVG9SaG8gKTtcclxuICAgIGNvbnN0IHJvVExEZXNjcmlwdGlvbiA9IGdldFJlbGF0aXZlU2l6ZURlc2NyaXB0aW9uKCByVG9MICk7XHJcbiAgICBjb25zdCByVG9BRGVzY3JpcHRpb24gPSBnZXRSZWxhdGl2ZVNpemVEZXNjcmlwdGlvbiggclRvQSApO1xyXG5cclxuICAgIGxldCBkZXNjcmlwdGlvbjtcclxuICAgIGNvbnN0IGNvbXBhcmFibGVSYW5nZSA9IFJlc2lzdGFuY2VJbkFXaXJlQ29uc3RhbnRzLlJFTEFUSVZFX1NJWkVfTUFQLmNvbXBhcmFibGUucmFuZ2U7XHJcblxyXG4gICAgLy8gZXZlbiBpZiByaWdodCBoYW5kIHNpZGUgdmFyaWFibGVzIGFyZSBub3QgY29tcGFyYWJsZSBpbiBzaXplLCBpZiBSIGlzIHJlbGF0aXZlbHkgbGFyZ2VyIG9yIHNtYWxsZXIgdGhhbiBhbGxcclxuICAgIC8vIGJ5IHRoZSBzYW1lIGFtb3VudCwgY29tYmluZSBzaXplIGRlc2NyaXB0aW9uXHJcbiAgICBjb25zdCByZWxhdGl2ZVNpemVLZXlzID0gT2JqZWN0LmtleXMoIFJlc2lzdGFuY2VJbkFXaXJlQ29uc3RhbnRzLlJFTEFUSVZFX1NJWkVfTUFQICk7XHJcbiAgICBsZXQgYWxsUmVsYXRpdmVTaXplc1NhbWUgPSBmYWxzZTtcclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IHJlbGF0aXZlU2l6ZUtleXMubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgIGNvbnN0IGtleSA9IHJlbGF0aXZlU2l6ZUtleXNbIGkgXTtcclxuICAgICAgY29uc3Qgc2l6ZVJhbmdlID0gUmVzaXN0YW5jZUluQVdpcmVDb25zdGFudHMuUkVMQVRJVkVfU0laRV9NQVBbIGtleSBdLnJhbmdlO1xyXG4gICAgICBjb25zdCBjb250YWluc1JUb1JobyA9IHNpemVSYW5nZS5jb250YWlucyggclRvUmhvICk7XHJcbiAgICAgIGNvbnN0IGNvbnRhaW5zUlRvQSA9IHNpemVSYW5nZS5jb250YWlucyggclRvQSApO1xyXG4gICAgICBjb25zdCBjb250YWluc1JUb0wgPSBzaXplUmFuZ2UuY29udGFpbnMoIHJUb0wgKTtcclxuXHJcbiAgICAgIGlmICggY29udGFpbnNSVG9SaG8gJiYgY29udGFpbnNSVG9BICYmIGNvbnRhaW5zUlRvTCApIHtcclxuICAgICAgICBhbGxSZWxhdGl2ZVNpemVzU2FtZSA9IHRydWU7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZiAoICggY29tcGFyYWJsZVJhbmdlLmNvbnRhaW5zKCBsVG9BICkgJiYgY29tcGFyYWJsZVJhbmdlLmNvbnRhaW5zKCBsVG9SaG8gKSApIHx8IGFsbFJlbGF0aXZlU2l6ZXNTYW1lICkge1xyXG5cclxuICAgICAgLy8gYWxsIHJpZ2h0IGhhbmQgc2lkZSBsZXR0ZXJzIGFyZSBjb21wYXJhYmxlIGluIHNpemVcclxuICAgICAgZGVzY3JpcHRpb24gPSBTdHJpbmdVdGlscy5maWxsSW4oIHJob0xBbmRBQ29tcGFyYWJsZVBhdHRlcm5TdHJpbmcsIHtcclxuICAgICAgICByVG9BbGw6IHJUb1Job0Rlc2NyaXB0aW9uIC8vIGFueSBzaXplIGRlc2NyaXB0aW9uIHdpbGwgd29ya1xyXG4gICAgICB9ICk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICggY29tcGFyYWJsZVJhbmdlLmNvbnRhaW5zKCBsVG9BICkgKSB7XHJcblxyXG4gICAgICAvLyBMIGFuZCBBIGFyZSBjb21wYXJhYmxlLCBzbyB0aGV5IGFyZSB0aGUgc2FtZSBzaXplIHJlbGF0aXZlIHRvIFJcclxuICAgICAgZGVzY3JpcHRpb24gPSBTdHJpbmdVdGlscy5maWxsSW4oIGxBbmRBQ29tcGFyYWJsZVBhdHRlcm5TdHJpbmcsIHtcclxuICAgICAgICByVG9SaG86IHJUb1Job0Rlc2NyaXB0aW9uLFxyXG4gICAgICAgIHJUb0xBbmRBOiByb1RMRGVzY3JpcHRpb24gLy8gZWl0aGVyIGxlbmd0aCBvciBhcmVhIHJlbGF0aXZlIGRlc2NyaXB0aW9ucyB3aWxsIHdvcmtcclxuICAgICAgfSApO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcblxyXG4gICAgICAvLyBhbGwgcmVsYXRpdmUgc2l6ZXMgY291bGQgYmUgdW5pcXVlXHJcbiAgICAgIGRlc2NyaXB0aW9uID0gU3RyaW5nVXRpbHMuZmlsbEluKCBub25lQ29tcGFyYWJsZVBhdHRlcm5TdHJpbmcsIHtcclxuICAgICAgICByVG9SaG86IHJUb1Job0Rlc2NyaXB0aW9uLFxyXG4gICAgICAgIHJUb0w6IHJvVExEZXNjcmlwdGlvbixcclxuICAgICAgICByVG9BOiByVG9BRGVzY3JpcHRpb25cclxuICAgICAgfSApO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBkZXNjcmlwdGlvbjtcclxuICB9XHJcbn1cclxuXHJcbnJlc2lzdGFuY2VJbkFXaXJlLnJlZ2lzdGVyKCAnRm9ybXVsYU5vZGUnLCBGb3JtdWxhTm9kZSApO1xyXG5cclxuLyoqXHJcbiAqIEdldCBhIHJlbGF0aXZlIHNpemUgZGVzY3JpcHRpb24gZnJvbSBhIHJlbGF0aXZlIHNjYWxlLCB1c2VkIHRvIGRlc2NyaWJlIGxldHRlcnMgcmVsYXRpdmUgdG8gZWFjaCBvdGhlci4gV2lsbCByZXR1cm5cclxuICogc29tZXRoaW5nIGxpa2VcclxuICpcclxuICogXCJjb21wYXJhYmxlIHRvXCIgb3JcclxuICogXCJtdWNoIG11Y2ggbGFyZ2VyIHRoYW5cIlxyXG4gKlxyXG4gKiBAcGFyYW0ge251bWJlcn0gcmVsYXRpdmVTY2FsZVxyXG4gKiBAcmV0dXJucyB7c3RyaW5nfVxyXG4gKi9cclxuY29uc3QgZ2V0UmVsYXRpdmVTaXplRGVzY3JpcHRpb24gPSByZWxhdGl2ZVNjYWxlID0+IHtcclxuXHJcbiAgLy8gZ2V0IGRlc2NyaWJlZCByYW5nZXMgb2YgZWFjaCByZWxhdGl2ZSBzY2FsZVxyXG4gIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyggUmVzaXN0YW5jZUluQVdpcmVDb25zdGFudHMuUkVMQVRJVkVfU0laRV9NQVAgKTtcclxuICBmb3IgKCBsZXQgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgY29uc3QgcmVsYXRpdmVFbnRyeSA9IFJlc2lzdGFuY2VJbkFXaXJlQ29uc3RhbnRzLlJFTEFUSVZFX1NJWkVfTUFQWyBrZXlzWyBpIF0gXTtcclxuXHJcbiAgICBpZiAoIHJlbGF0aXZlRW50cnkucmFuZ2UuY29udGFpbnMoIHJlbGF0aXZlU2NhbGUgKSApIHtcclxuICAgICAgcmV0dXJuIHJlbGF0aXZlRW50cnkuZGVzY3JpcHRpb247XHJcbiAgICB9XHJcbiAgfVxyXG4gIHRocm93IG5ldyBFcnJvciggYG5vIGRlc2NyaXB0aW9uIGZvdW5kIGZvciByZWxhdGl2ZVNjYWxlOiAke3JlbGF0aXZlU2NhbGV9YCApO1xyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgRm9ybXVsYU5vZGU7Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsT0FBT0EsT0FBTyxNQUFNLCtCQUErQjtBQUNuRCxTQUFTQyxLQUFL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